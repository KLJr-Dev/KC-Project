# v0.1.x Identity & Authentication Surface — Summary

This document captures the state of KC-Project at the end of the **v0.1.x identity phase** (v0.1.0 through v0.1.5).

---

## What Was Built

The identity phase introduced authentication with intentionally weak security controls, creating a realistic attack surface for future penetration testing.

### Authentication endpoints

- `POST /auth/register` — create user, store plaintext password, issue JWT
- `POST /auth/login` — plaintext password comparison, issue JWT
- `GET /auth/me` — protected endpoint, returns authenticated user profile
- `POST /auth/logout` — cosmetic logout, does nothing server-side

### JWT infrastructure

- **Algorithm**: HS256 (symmetric — same key signs and verifies)
- **Secret**: `'kc-secret'` (hardcoded in `JwtModule.register()`)
- **Payload**: `{ sub: userId }` — minimal, no role/scope/email
- **Expiration**: none (`exp` claim absent — tokens live forever)
- **Storage**: `localStorage` under key `kc_auth` (XSS-accessible)
- **Revocation**: none (no deny-list, no session table)

### Frontend auth integration

- `AuthContext` provider with `login()`, `logout()`, `isAuthenticated`
- `getHeaders()` attaches JWT as Bearer header on every API request
- Header component displays username via `authMe()` on mount
- `authLogout()` called fire-and-forget before clearing localStorage
- All frontend files carry CWE-615 warnings (CSR comment disclosure)

### Testing

- 17 e2e tests via supertest covering all auth endpoints and edge cases
- Tests explicitly prove vulnerabilities (token replay, brute-force, enumeration, weak passwords)

---

## Version-by-Version Recap

| Version | Milestone | New CWEs | Tests Added |
|---------|-----------|----------|-------------|
| v0.1.0 | User entity with sequential IDs, in-memory store, CRUD endpoints | CWE-330 | — |
| v0.1.1 | Registration endpoint, plaintext password storage, leaky duplicate error | CWE-256, CWE-209 | 3 |
| v0.1.2 | Login endpoint, plaintext comparison, distinct error messages | CWE-256, CWE-204 | 4 |
| v0.1.3 | Real JWTs (HS256), JwtAuthGuard, GET /auth/me, Bearer headers | CWE-347, CWE-798, CWE-613, CWE-922, CWE-862, CWE-942, CWE-319, CWE-615 | 3 |
| v0.1.4 | Cosmetic logout, token replay after logout proven | CWE-613 | 3 |
| v0.1.5 | No rate limiting, no account lockout, weak passwords, enumeration test | CWE-307, CWE-521 | 4 |

**Total: 18 CWE entries, 17 e2e tests**

---

## Intentional Vulnerabilities (Complete List)

| # | Weakness | CWE | OWASP Top 10 | Introduced |
|---|----------|-----|-------------|------------|
| 1 | Sequential predictable user IDs | CWE-330 | A01:2021 | v0.1.0 |
| 2 | Plaintext password storage | CWE-256 | A07:2021 | v0.1.1 |
| 3 | Leaky duplicate error (email in 409 message) | CWE-209 | A07:2021 | v0.1.1 |
| 4 | Plaintext password comparison | CWE-256 | A07:2021 | v0.1.2 |
| 5 | Distinct auth errors enable user enumeration | CWE-204 | A07:2021 | v0.1.2 |
| 6 | Weak JWT secret (hardcoded `'kc-secret'`) | CWE-798 | A02:2021 | v0.1.3 |
| 7 | JWT signed with weak HS256 algorithm | CWE-347 | A02:2021 | v0.1.3 |
| 8 | No token expiration (no `exp` claim) | CWE-613 | A07:2021 | v0.1.3 |
| 9 | Guard does not check user still exists | CWE-613 | A07:2021 | v0.1.3 |
| 10 | Token stored in localStorage (XSS-accessible) | CWE-922 | A07:2021 | v0.1.3 |
| 11 | Missing authorization on /auth/me | CWE-862 | A01:2021 | v0.1.3 |
| 12 | Permissive CORS (all origins) | CWE-942 | A05:2021 | v0.1.3 |
| 13 | Cleartext transport (HTTP, no TLS) | CWE-319 | A02:2021 | v0.1.3 |
| 14 | Source code comments in CSR bundle | CWE-615 | A05:2021 | v0.1.3 |
| 15 | Cosmetic logout (no server-side invalidation) | CWE-613 | A07:2021 | v0.1.4 |
| 16 | Token replay after logout | CWE-613 | A07:2021 | v0.1.4 |
| 17 | No rate limiting on auth endpoints | CWE-307 | A07:2021 | v0.1.5 |
| 18 | Weak password requirements | CWE-521 | A07:2021 | v0.1.5 |

---

## Key Decisions Made

ADRs introduced or relied upon during v0.1.x:

- **ADR-008** — In-memory storage for v0.x (deferred persistence to v0.2.x)
- **ADR-009** — localStorage for client-side auth state
- **ADR-010** — Tailwind CSS for styling
- **ADR-011** — Client-side rendering only (no SSR)
- **ADR-012** — JWT over server-side sessions
- **ADR-013** — Perpetual insecure/secure expansion cycle versioning
- **ADR-014** — GitHub for version control
- **ADR-015** — Branching strategy (main/dev/frontend/backend)
- **ADR-016** — Monorepo structure
- **ADR-017** — Deferred CI/CD
- **ADR-018** — OpenAPI/Swagger with CLI plugin

---

## What Is Not Present

The following remain absent at the end of v0.1.x. Each will be introduced per the roadmap:

- **Database / persistence** — all data is in-memory, resets on restart (v0.2.x)
- **Password hashing** — passwords stored and compared as plaintext (v2.0.0)
- **Token expiration / revocation** — JWTs live forever, logout is cosmetic (v2.0.0)
- **Rate limiting** — unlimited auth attempts, no lockout (v2.0.0)
- **Input validation** — no class-validator, no ValidationPipe (v2.0.0)
- **Authorization / RBAC** — no role checks, no access control (v0.4.x)
- **File handling** — file module is stub only (v0.3.x)
- **Containers / deployment** — local dev only (v0.5.x)
- **CI/CD** — no pipelines, no automated testing
- **TLS** — all traffic is plain HTTP (v0.5.x / v2.0.0)

---

## Transition to v0.2.x

The v0.2.x phase introduces the **persistence and database surface**:

- v0.2.0 introduces PostgreSQL (local or Docker)
- v0.2.1 persists authentication credentials in the database
- v0.2.2–v0.2.5 introduce identifier trust failures, enumeration via sequential DB IDs, error/metadata leakage from SQL, and schema migrations

The identity surface from v0.1.x carries forward unchanged. Persistence makes the existing weaknesses **permanent and exploitable against a real database** — plaintext passwords in PostgreSQL, sequential integer primary keys, verbose SQL errors exposed to clients.
